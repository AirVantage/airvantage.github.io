<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Setting up an AirVantage persistence service for openHAB</title>
<!--     <meta name="description" content="AirVantage ♡ Open Source" /> -->
    <meta name="robots" content="index, follow" />

    <link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feed.xml" />

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js" type="text/javascript"></script>
    <script src="/resources/js/main.js" type="text/javascript"></script>

    <!-- flexslider -->
    <link type="text/css" rel="stylesheet" href="/resources/css/flexslider.css" />
    <script type="text/javascript" src="/resources/js/jquery.flexslider-min.js"></script>

    <link href="/resources/css/misc_icons.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="/resources/css/style.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="/resources/css/airvantage.github.io.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="/resources/css/pygments/default.css" rel="stylesheet" type="text/css" media="screen" />

    <!-- lightbox2 -->
    <script type="text/javascript" src="/resources/js/lightbox-2.6.min.js"></script>
    <link href="/resources/css/lightbox.css" rel="stylesheet" type="text/css" media="screen" />

    <!-- highlight syntax -->
    <script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    <!-- GA tracker -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-594061-16', 'airvantage.github.io');
      ga('send', 'pageview');

    </script>
    <!-- end GA tracker -->

</head>
<body itemscope itemtype="http://schema.org/WebPage">
     <div class="wrapper">
        <div id="top">
            <header>
                <h1><a title="back to top" href="/#introduction">Sierra Wireless - AirVantage</a></h1>
                <nav >
                    <a href="/#features"><i class="icon-github"></i> Repositories</a>
                    <a href="/devkit" >Dev. kit</a>
                    <a href="/#who">Who we are</a>
                    <a href="/blog"  class="link-selected" >Blog</a>
                    <a href="http://developer.sierrawireless.com" target="_blank"><span style="font-family: 'swop_icons' ; font-size:5em; line-height:0em; vertical-align:-0.2em;">L</span></a>

                    <!-- Twitter follow us buton -->
                    <div style="display : inline-table;margin-top : 6px;">

                      <a href="https://twitter.com/airvantage" class="twitter-follow-button" data-show-count="false" data-size="small" data-show-screen-name="false">Follow @airvantage</a>
                      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                    </div>

                    <!-- Placez cette balise où vous souhaitez faire apparaître le gadget Bouton +1. -->
                    <div style="display: inline-table;margin-top: 5px;">
                      <div class="g-plusone" data-size="medium"></div>
                    </div>
                    <!-- Placez cette ballise après la dernière balise Bouton +1. -->
                    <script type="text/javascript">
                      window.___gcfg = {lang: 'fr'};

                      (function() {
                        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                        po.src = 'https://apis.google.com/js/plusone.js';
                        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                      })();
                    </script>


                </nav>
            </header>
        </div>
        
            <div id="content">
              

<div id="post" itemscope="" itemtype="http://schema.org/BlogPosting">
	

<div id="page-navigation"> 
        <div class="clear">&nbsp;</div> 
        <span class="left"> 
         
                <a href="/blog/2013/10/01/top-avep-features-oct13-5-alerts" title="Previous Post: 
Top AVEP features in Oct'13 release&#58; 5. Alerts">&laquo; Top AVEP features in Oct'13 release&#58; 5. Alerts</a> 
         
        </span> 
         | 

        <span class="right"> 
         
                <a href="/blog/2013/07/31/Airvantage-D3" title="next Post: 
M2M data visualisation with D3 and AirVantage">M2M data visualisation with D3 and AirVantage &raquo; </a> 
         
        </span> 
        <div class="clear">&nbsp;</div> 
</div> 
	<h1 style="display:inline-block;" itemprop="name">Setting up an AirVantage persistence service for openHAB</h1> by 
		<div style="display:inline;" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
			<a href="/authors/kartben/page1">
				<span class="author">
					<span itemprop="name">
						Benjamin Cabé
					</span>
				</span>
			</a>	

			
	        <div class="gplus" style="display: inline;font-size: 0.6em;">
	            [<a rel="author" href="https://plus.google.com/112837264176638481892?rel=author" target="_blank">
	                <i class="icon-gplus"></i>
	            </a>]
	        </div>
	        
       </div>

	<div itemprop="articleBody">
		<center style="margin-bottom: 2em; /*margin-top: 1em;*/"><iframe width="560" height="315" src="//www.youtube.com/embed/aHqghpPgJQs" frameborder="0" allowfullscreen=""></iframe></center>

<p><img style="float:left; margin-right:15px;" src="/resources/img/blog/2013-08-08-openhab-with-airvantage/openHAB_Logo.png" itemprop="image" />
<a href="https://code.google.com/p/openhab/">openHAB</a> is a Java/OSGi-based open-source project that aims at providing a universal integration platform for all things around home automation.</p>

<p>It’s a project I’ve been following from a distance for the last couple years and that I find particularly impressive, both in terms of features it exposes to the end user and in terms of architecture and design, being in my opinion a brilliant example of how one can use OSGi to build a modular application.</p>

<h2 id="openhab-in-a-nutshell">openHAB in a nutshell</h2>

<p>DISCLAIMER: I am by no means an openHAB expert! :-)</p>

<p>Anyone playing with openHAB for a few minutes will understand the gist of it. In a nutshell, it allows to bind logical representations of physical objects (that send events and may be actionable) with each other via an event bus. The way objects will eventually interact with each other can be expressed using a rules engine, and it is also possible to build very fancy UIs by binding widgets on the physical “items”. Last but not least, openHAB is not only able to orchestrate the physical objects on the fly, but it can also be configured with persistence rules for e.g logging some events, plotting them on charts, or store them in an online service. You get it: why not adding the capability to persist data in <a href="http://airvantage.net">AirVantage</a>?</p>

<h2 id="openhab-persistence-services">openHAB persistence services</h2>

<p>Implementing a new persistence provider for openHAB is actually rather straightforward: you simply need to register a <code>PersistenceService</code> implementation that will be in charge of storing (i.e. logging, POSTing to a REST API, …) items. The items you wish to store are described in a persistence rules file which is, again, rather straightforward:</p>

<pre><code class="language-json">Strategies {
  everyMinute : "0 * * * * ?"
}

Items {
  // log all temperatures every minute
  Temperature* -&gt; "temperatures" : strategy = everyMinute
}
</code></pre>

<h2 id="airvantage-persistence-service">AirVantage persistence service</h2>

<p>The idea here is to provision a system on AirVantage that is configured for REST communications, and a good start is definitely to follow the <a href="http://airvantage.github.io/tutorials/2013/07/05/rest-for-devices/">dedicated tutorial</a>. When your system is properly configured, next step is to add an AirVantage persistence bundle to your openHAB setup, and to propertly configure it.</p>

<p>I have <a href="https://github.com/kartben/org.openhab.persistence.airvantage">put on GitHub</a> the source code of a bundle corresponding to the AirVantage persistence provider that I wrote. You can install it very simply by following the <a href="https://code.google.com/p/openhab/wiki/Addons">instructions</a> on openHAB, for the JAR that you can download <a href="https://kartben.github.com/org.openhab.persistence.airvantage/org.openhab.persistence.airvantage-1.3.0-SNAPSHOT.jar">here</a>.</p>

<p>Add to your openHAB configuration the two following lines:</p>

<pre><code class="language-bash"># The serial number of the system you created in AirVantage
airvantage:systemId=OHAB49258684236
# The password you configured for this system's REST communication channel
airvantage:systemPassword=secret
</code></pre>

<p>And then, you will need to create an <code>airvantage.persist</code> file in your <code>persist/</code> folder for indicating what items you want to synchronize with AirVantage. For each item, you will want to set the path of the variable as indicated in your model. An example of such a file could be:</p>

<pre><code>Strategies {
  default = everyChange 
}

Items {
  Temperature_GF_Corridor -&gt; "demohouse.gf.corridor.temperature"
  Temperature_GF_Toilet -&gt; "demohouse.gf.toilet.temperature"

  Temperature_FF_Bath -&gt; "demohouse.ff.bathroom.temperature"
  Heating_FF_Bath -&gt; "demohouse.ff.bathroom.heating"
}
</code></pre>

<p>With very little effort, you should be able to do something very similar, and therefore enable server-side consolidation of all your home automation data for years, and use the AirVantage API to display graphs and the like.</p>

<p>Please comment below if you give this work a try, and also feel free to fork the GitHub repo if you feel like this could be improved (and it certainly can!).</p>

	</div>
	<p></p>
	<hr>
	<div id="related_posts">
		<h2>Related Posts</h2>
		<ul class="posts">

			
			
			  
			  
			  
			    <li>
					<span>09 Jan 2014</span>
					&raquo;
					<a href="/blog/2014/01/09/airvantage-parse">Connect Facebook to IoT using AirVantage and Parse</a>
				</li>
			                         
			
			  
			  
			                         
			
			  
			  
			  
			    <li>
					<span>04 Oct 2013</span>
					&raquo;
					<a href="/blog/2013/10/04/top-avep-features-oct13-1-mqtt-support">Top AVEP features in Oct'13 release&#58; 1. MQTT support</a>
				</li>
			                         
			
			  
			  
			  
			    <li>
					<span>03 Oct 2013</span>
					&raquo;
					<a href="/blog/2013/10/03/top-avep-features-oct13-2-webhooks">Top AVEP features in Oct'13 release&#58; 2. Webhooks</a>
				</li>
			                         
			
			  
			  
			                         
			
			  
			  
			                         
			
			  
			  
			                         
			
			  
			  
			                         
			
			  
			  
			                         
			
			  
			  
			                         
			
		</ul>
	</div>

</div>
              
              <div id="comments">
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'airvantageopensourcecenter'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
             </div>
             
            </div>
         
    </div>
</body>
</html>
