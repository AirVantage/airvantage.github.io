<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Using REST API for devices</title>
<!--     <meta name="description" content="AirVantage ♡ Open Source" /> -->
    <meta name="robots" content="index, follow" />

    <link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feed.xml" />

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js" type="text/javascript"></script>
    <script src="/resources/js/main.js" type="text/javascript"></script>

    <!-- flexslider -->
    <link type="text/css" rel="stylesheet" href="/resources/css/flexslider.css" />
    <script type="text/javascript" src="/resources/js/jquery.flexslider-min.js"></script>

    <link href="/resources/css/misc_icons.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="/resources/css/style.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="/resources/css/airvantage.github.io.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="/resources/css/pygments/default.css" rel="stylesheet" type="text/css" media="screen" />

    <!-- lightbox2 -->
    <script type="text/javascript" src="/resources/js/lightbox-2.6.min.js"></script>
    <link href="/resources/css/lightbox.css" rel="stylesheet" type="text/css" media="screen" />

    <!-- highlight syntax -->
    <script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    <!-- GA tracker -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-594061-16', 'airvantage.github.io');
      ga('send', 'pageview');

    </script>
    <!-- end GA tracker -->

</head>
<body itemscope itemtype="http://schema.org/WebPage">
     <div class="wrapper">
        <div id="top">
            <header>
                <h1><a title="back to top" href="/#introduction">Sierra Wireless - AirVantage</a></h1>
                <nav >
                    <a href="/#features"><i class="icon-github"></i> Repositories</a>
                    <a href="/devkit" >Dev. kit</a>
                    <a href="/#who">Who we are</a>
                    <a href="/blog" >Blog</a>
                    <a href="http://developer.sierrawireless.com" target="_blank"><span style="font-family: 'swop_icons' ; font-size:5em; line-height:0em; vertical-align:-0.2em;">L</span></a>

                    <!-- Twitter follow us buton -->
                    <div style="display : inline-table;margin-top : 6px;">

                      <a href="https://twitter.com/airvantage" class="twitter-follow-button" data-show-count="false" data-size="small" data-show-screen-name="false">Follow @airvantage</a>
                      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                    </div>

                    <!-- Placez cette balise où vous souhaitez faire apparaître le gadget Bouton +1. -->
                    <div style="display: inline-table;margin-top: 5px;">
                      <div class="g-plusone" data-size="medium"></div>
                    </div>
                    <!-- Placez cette ballise après la dernière balise Bouton +1. -->
                    <script type="text/javascript">
                      window.___gcfg = {lang: 'fr'};

                      (function() {
                        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                        po.src = 'https://apis.google.com/js/plusone.js';
                        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                      })();
                    </script>


                </nav>
            </header>
        </div>
        
            <div id="content">
              <h1 id="using-rest-api-for-devices">Using REST API for devices</h1>

<p>This article explains the different steps to create an application when you want to use the REST API for devices to connect your application to AirVantage. </p>

<h2 id="application-model">Application Model</h2>

<p><strong>Step 1.</strong> The first step is to create the application model. You can create a file named <code>model.app</code> with the following content, you just need to change the <strong>type</strong> value with a unique identifier for your application and the <strong>name</strong> and <strong>revision</strong> with the apprioriate value for your use case.</p>

<p><strong>Application Model</strong></p>

<pre><code class="language-xml">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;app:application xmlns:app="http://www.sierrawireless.com/airvantage/application/1.0" 
        type="com.test.myapplication" 
        name="My Application" 
        revision="0.0.1"&gt;
 &lt;capabilities&gt;
  
  &lt;communication&gt;
   &lt;protocol comm-id="SERIAL" type="REST" /&gt;
  &lt;/communication&gt;
   
  &lt;data&gt;
   &lt;encoding type="REST"&gt;
    &lt;asset default-label="My Machine" id="machine"&gt;
     &lt;variable default-label="Temperature" path="temperature" type="double"/&gt;
      &lt;setting default-label="Threshold" path="threshold" type="int"/&gt;
     &lt;/asset&gt;
   &lt;/encoding&gt;
  &lt;/data&gt;  

 &lt;/capabilities&gt;
&lt;/app:application&gt;
</code></pre>

<p><strong>Step 2.</strong> You can then customize the “data” part to define the different variables and settings used by your application.</p>

<p><strong>Step 3.</strong> You create a zip file containing this file.</p>

<p><strong>Step 4.</strong> You release this zip file in your application repository in AirVantage. AirVantage &gt; Develop &gt; My Apps &gt; Release</p>

<p>Once you validated everything is working fine, you can change the state of your application to “PUBLISHED” by selecting the application in My Apps and clicking on the “Publish” button. 
Now the application is available and in AirVantage and can be assigned to systems.</p>

<h2 id="register-your-system">Register your system</h2>

<ol>
  <li>Go to Inventory &gt; Systems.</li>
  <li>Click on the “Create” action.</li>
  <li>In the “Create System” dialog:
    <ol>
      <li>“System” step: Specify an optional name for your system.</li>
      <li>“Details” step: Click “Create gateway” and enter the identifier of the device in the “Serial Number” field.</li>
      <li>“Subscription” step: You won’t create nor use any.</li>
      <li>“Applications” step: Select the application you previously released.</li>
      <li>“Credentials” step: Enter the password used to authenticate the device.</li>
      <li>Click on “Create”.</li>
    </ol>
  </li>
  <li>In the grid, select the newly created system and click on the “Activate” action.</li>
</ol>

<h2 id="send-and-receive-data">Send and Receive data</h2>

<p>Once your device is registered in AirVantage, you can start developing the embedded application that will use REST API for devices to communicate with AirVantage. Here are the different calls to integrate in the embedded application to send and receive data with AirVantage:</p>

<h3 id="authentication">Authentication</h3>

<p>The REST API for devices uses <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Authentication</a> to authenticate devices.
So you need to specify the Authentication header for each API call. The username is the serial number of the gateway in AirVantage and the password is the one set during the creation of the system.
Then you need to combine the two into a string “username:password” and encode the resulted string using Base64.
Finally, you specify the Authentication header in the API calls.</p>

<pre><code>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==
</code></pre>

<h3 id="send-data-to-airvantage">Send data to AirVantage</h3>

<p>You can use the Messages API to send data from the device to AirVantage. A message can contain several data and several datapoints per data. Then you can easily send a complete status or historical values in one message.</p>

<p><strong>Request:</strong></p>

<pre><code class="language-json">POST https://na.airvantage.net/device/messages
Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==
Content-Type: application/json
[
  {
    "machine.temperature": [{
      "timestamp" : 1349907137000, 
      "value" : "23.2"
    },
    {
      "timestamp" : 1349908137000, 
      "value" : "24.5"
    },
    {
      "timestamp" : 1349909137000, 
      "value" : "22.9"
    }]
  },
  {
    "machine.threshold": [{
      "timestamp" : 1349907137000, 
      "value" : "30"
    }]
  }
]
</code></pre>

<p>This message sends 3 values for the temperature with different timestamp and one value for the threshold parameter.</p>

<p>Once AirVantage receives this message, data are stored and can be accessed by the Data API on System (Last datapoints, Historical aggregated datapoints, Historical raw datapoints, Export datapoints) </p>

<h3 id="receive-tasks-from-airvantage">Receive tasks from AirVantage</h3>

<p>A device can not only push data to AirVantage but you can also use AirVantage to request the device to execute some tasks. Currently the REST API for devices supports 2 kind of tasks: read and write.</p>

<p>A <strong>read</strong> task requests the device to send back to the server the current values for a set of data. It’s a way for a user to request the device to “refresh” the value of a data on the server. This operation is only for variables and settings. To create this operation from AirVantage API, you need to call the “Retrieve data” API (see documentation of System API).</p>

<p>A <strong>write</strong> task requests the device to change the value of a data locally on the device. It’s a way to interact with the device and change the behaviour of the embedded application. This operation is only available for settings. To create this operation from AirVantage API, you need to call the “Apply settings” API (see documentation of System API).</p>

<p>The device needs to call periodically the following API:</p>

<p><strong>Request:</strong></p>

<pre><code class="language-json">GET https://na.airvantage.net/device/tasks
Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==
</code></pre>

<p><strong>Response:</strong></p>

<pre><code class="language-json">HTTP/1.1 200 OK
Content-Type: application/json
[
  {
    "uid" : "3c12547b613740adb686271bdc8f097c",
    "timestamp" : 1348836320188,
    "read" : ["machine.temperature"]
  }, 
  {
    "uid": "8006cc58ba2141f69161a78f1bfdea1d",
    "timestamp": 1348836320566,
    "write" : [{"machine.threshold" : 25}}]
  }
] 
</code></pre>

<p>In this example, AirVantage is asking to the device to send the current temperature and requests to change the value of the threshold to 25. Once the API is called, AirVantage assumed the tasks have been retrieved by the device and then acknowledge automatically the tasks. In the current example, the device will probably directly call the message API to send back to AirVantage the last value of the temperature.</p>

              
              <div id="comments">
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'airvantageopensourcecenter'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
             </div>
             
            </div>
         
    </div>
</body>
</html>
